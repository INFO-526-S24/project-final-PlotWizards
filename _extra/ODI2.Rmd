---
title: "Cricket Match Dashboard"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(highcharter)
library(htmltools)
library(viridis)
library(knitr)
library(lubridate)
library(dplyr)
library(ggplot2)
library(shiny)

# Read the complete dataset outside the reactive context to improve performance
odi_data <- read.csv("D:/Spring 2024/filtered_data_5years.csv")
```

Column {data-width=500}
-----------------------------------------------------------------------

### Chart A

```{r}
# Load the plotly library
library(plotly)

# Define UI for the Shiny app
ui <- fluidPage(
  
  # Dropdown menu for selecting players
  selectInput(inputId = "player1", label = "Select Player 1:",
              choices = unique(odi_data$striker),
              selected = NULL, multiple = FALSE),
  
  selectInput(inputId = "player2", label = "Select Player 2:",
              choices = unique(odi_data$striker),
              selected = NULL, multiple = FALSE),
  
  # Plot output
  plotlyOutput(outputId = "batting_performance_plot", height = "400px")
)

# Define server logic
server <- function(input, output) {
  
  # Reactive function to filter data based on selected players
  player1_data <- reactive({
    odi_data %>%
      filter(striker == input$player1) %>%
      group_by(season) %>%
      summarise(total_runs = sum(as.numeric(runs_off_bat)), .groups = 'drop')
  })
  
  player2_data <- reactive({
    odi_data %>%
      filter(striker == input$player2) %>%
      group_by(season) %>%
      summarise(total_runs = sum(as.numeric(runs_off_bat)), .groups = 'drop')
  })
  
  # Render the interactive plot using plotly
  output$batting_performance_plot <- renderPlotly({
    
    # Filter and aggregate data for selected players
    player1 <- player1_data()
    player2 <- player2_data()
    
    # Plot batting performance as bar plots using plotly
    plot1 <- ggplot(player1, aes(x = season, y = total_runs)) +
      geom_bar(stat = "identity", fill = "blue") +
      labs(title = paste("Batting Performance of", input$player1),
           x = "Season",
           y = "Total Runs") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Adjust x-axis label angle
    
    plot2 <- ggplot(player2, aes(x = season, y = total_runs)) +
      geom_bar(stat = "identity", fill = "red") +
      labs(title = paste("Batting Performance of", input$player2),
           x = "Season",
           y = "Total Runs") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Adjust x-axis label angle
    
    # Convert ggplot plots to plotly for interactivity
    plotly::subplot(plot1, plot2, nrows = 1)
  })
}

# Run the Shiny app
shinyApp(ui = ui, server = server)


```

Column {data-width=500}
-----------------------------------------------------------------------

### Chart B

```{r}
# Load the plotly library
library(plotly)

# Define UI for the Shiny app
ui <- fluidPage(
  
  # Dropdown menu for selecting players
  selectInput(inputId = "player1", label = "Select Player 1:",
              choices = unique(odi_data$bowler),
              selected = NULL, multiple = FALSE),
  
  selectInput(inputId = "player2", label = "Select Player 2:",
              choices = unique(odi_data$bowler),
              selected = NULL, multiple = FALSE),
  
  # Plot output
  plotlyOutput(outputId = "bowling_performance_plot", height = "400px")
)

# Define server logic
server <- function(input, output) {
  
  # Reactive function to filter data based on selected players
  player1_data <- reactive({
    odi_data %>%
      filter(bowler == input$player1) %>%
      group_by(season) %>%
      summarise(total_wickets = sum(as.numeric(win_by_wickets, na.rm = TRUE)), .groups = 'drop')
  })
  
  player2_data <- reactive({
    odi_data %>%
      filter(bowler == input$player2) %>%
      group_by(season) %>%
      summarise(total_wickets = sum(as.numeric(win_by_wickets, na.rm = TRUE)), .groups = 'drop')
  })
  
  # Render the interactive plot using plotly
  output$bowling_performance_plot <- renderPlotly({
    
    # Filter and aggregate data for selected players
    player1 <- player1_data()
    player2 <- player2_data()
    
    # Plot bowling performance as bar plots using plotly
    plot1 <- ggplot(player1, aes(x = season, y = total_wickets)) +
      geom_bar(stat = "identity", fill = "blue") +
      labs(title = paste("Bowling Performance of", input$player1),
           x = "Season",
           y = "Total Wickets") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Adjust x-axis label angle
    
    plot2 <- ggplot(player2, aes(x = season, y = total_wickets)) +
      geom_bar(stat = "identity", fill = "red") +
      labs(title = paste("Bowling Performance of", input$player2),
           x = "Season",
           y = "Total Wickets") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Adjust x-axis label angle
    
    # Convert ggplot plots to plotly for interactivity
    plotly::subplot(plot1, plot2, nrows = 1)
  })
}

# Run the Shiny app
shinyApp(ui = ui, server = server)

```


